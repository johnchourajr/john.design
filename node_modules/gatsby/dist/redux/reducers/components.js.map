{"version":3,"sources":["../../../src/redux/reducers/components.ts"],"names":["programStatus","componentsReducer","state","Map","action","type","payload","componentPath","component","get","query","pages","Set","isInBootstrap","add","path","set","delete"],"mappings":";;;;;;;AAAA;;AAGA,IAAIA,aAAa,GAAI,eAArB,C,CAEA;AACA;;AACO,MAAMC,iBAAiB,GAAG,CAC/BC,KAAiC,GAAG,IAAIC,GAAJ,EADL,EAE/BC,MAF+B,KAGA;AAC/B,UAAQA,MAAM,CAACC,IAAf;AACE,SAAM,cAAN;AACE,aAAO,IAAIF,GAAJ,EAAP;;AACF,SAAM,oBAAN;AACEH,MAAAA,aAAa,GAAGI,MAAM,CAACE,OAAvB;AACA,aAAOJ,KAAP;;AACF,SAAM,aAAN;AAAoB;AAClBE,QAAAA,MAAM,CAACE,OAAP,CAAeC,aAAf,GAA+B,4BAAUH,MAAM,CAACE,OAAP,CAAeE,SAAzB,CAA/B,CADkB,CAElB;;AACA,YAAIA,SAAS,GAAGN,KAAK,CAACO,GAAN,CAAUL,MAAM,CAACE,OAAP,CAAeC,aAAzB,CAAhB;;AACA,YAAI,CAACC,SAAL,EAAgB;AACdA,UAAAA,SAAS,GAAG;AACVD,YAAAA,aAAa,EAAEH,MAAM,CAACE,OAAP,CAAeC,aADpB;AAEVG,YAAAA,KAAK,EAAG,EAFE;AAGVC,YAAAA,KAAK,EAAE,IAAIC,GAAJ,EAHG;AAIVC,YAAAA,aAAa,EAAE;AAJL,WAAZ;AAMD;;AACDL,QAAAA,SAAS,CAACG,KAAV,CAAgBG,GAAhB,CAAoBV,MAAM,CAACE,OAAP,CAAeS,IAAnC;AACAP,QAAAA,SAAS,CAACK,aAAV,GAA0Bb,aAAa,KAAM,eAA7C;AACAE,QAAAA,KAAK,CAACc,GAAN,CAAUZ,MAAM,CAACE,OAAP,CAAeC,aAAzB,EAAwCC,SAAxC;AACA,eAAON,KAAP;AACD;;AACD,SAAM,iBAAN;AAAwB;AACtBE,QAAAA,MAAM,CAACE,OAAP,CAAeC,aAAf,GAA+B,4BAAUH,MAAM,CAACE,OAAP,CAAeC,aAAzB,CAA/B;AACA,cAAMC,SAAS,GAAGN,KAAK,CAACO,GAAN,CAAUL,MAAM,CAACE,OAAP,CAAeC,aAAzB,CAAlB;AACAC,QAAAA,SAAS,CAACE,KAAV,GAAkBN,MAAM,CAACE,OAAP,CAAeI,KAAjC;AACAR,QAAAA,KAAK,CAACc,GAAN,CAAUZ,MAAM,CAACE,OAAP,CAAeC,aAAzB,EAAwCC,SAAxC;AACA,eAAON,KAAP;AACD;;AACD,SAAM,mCAAN;AAA0C;AACxCE,QAAAA,MAAM,CAACE,OAAP,CAAeC,aAAf,GAA+B,4BAAUH,MAAM,CAACE,OAAP,CAAeC,aAAzB,CAA/B;AACAL,QAAAA,KAAK,CAACe,MAAN,CAAab,MAAM,CAACE,OAAP,CAAeC,aAA5B;AACA,eAAOL,KAAP;AACD;;AACD,SAAM,aAAN;AAAoB;AAClB,cAAMM,SAAS,GAAGN,KAAK,CAACO,GAAN,CAAU,4BAAUL,MAAM,CAACE,OAAP,CAAeE,SAAzB,CAAV,CAAlB;AACAA,QAAAA,SAAS,CAACG,KAAV,CAAgBM,MAAhB,CAAuBb,MAAM,CAACE,OAAP,CAAeS,IAAtC;AACA,eAAOb,KAAP;AACD;AAvCH;;AA0CA,SAAOA,KAAP;AACD,CA/CM","sourcesContent":["import normalize from \"normalize-path\"\nimport { IGatsbyState, ActionsUnion } from \"../types\"\n\nlet programStatus = `BOOTSTRAPPING`\n\n// TODO: replace usages of this reducer with queries.trackedComponents\n//  It is here merely for compatibility.\nexport const componentsReducer = (\n  state: IGatsbyState[\"components\"] = new Map(),\n  action: ActionsUnion\n): IGatsbyState[\"components\"] => {\n  switch (action.type) {\n    case `DELETE_CACHE`:\n      return new Map()\n    case `SET_PROGRAM_STATUS`:\n      programStatus = action.payload\n      return state\n    case `CREATE_PAGE`: {\n      action.payload.componentPath = normalize(action.payload.component)\n      // Create XState service.\n      let component = state.get(action.payload.componentPath)\n      if (!component) {\n        component = {\n          componentPath: action.payload.componentPath,\n          query: ``,\n          pages: new Set(),\n          isInBootstrap: true,\n        }\n      }\n      component.pages.add(action.payload.path)\n      component.isInBootstrap = programStatus === `BOOTSTRAPPING`\n      state.set(action.payload.componentPath, component)\n      return state\n    }\n    case `QUERY_EXTRACTED`: {\n      action.payload.componentPath = normalize(action.payload.componentPath)\n      const component = state.get(action.payload.componentPath)!\n      component.query = action.payload.query\n      state.set(action.payload.componentPath, component)\n      return state\n    }\n    case `REMOVE_STATIC_QUERIES_BY_TEMPLATE`: {\n      action.payload.componentPath = normalize(action.payload.componentPath)\n      state.delete(action.payload.componentPath)\n      return state\n    }\n    case `DELETE_PAGE`: {\n      const component = state.get(normalize(action.payload.component))!\n      component.pages.delete(action.payload.path)\n      return state\n    }\n  }\n\n  return state\n}\n"],"file":"components.js"}